language: java
os: osx
jdk: openjdk13

cache:
 directories:
  - $HOME/.gradle/caches/
  - $HOME/.gradle/wrapper/

before_install:
 - chmod +x gradlew
 - wget https://download.java.net/java/GA/jdk13.0.2/d4173c853231432d94f001e99d882ca7/8/GPL/openjdk-13.0.2_windows-x64_bin.zip
 - unzip openjdk-13.0.2_windows-x64_bin.zip
 - wget https://download.java.net/java/GA/jdk13.0.2/d4173c853231432d94f001e99d882ca7/8/GPL/openjdk-13.0.2_osx-x64_bin.tar.gz
 - tar -zxvf openjdk-13.0.2_osx-x64_bin.tar.gz

install: skip

script:
 - ./gradlew -b build-travis.gradle runtimeZip --warning-mode all --info

before_cache:
 - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
 - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

 after_success:
  - curl -T build/uPMT-osx-x64.zip ftp://$FTP_USER:$FTP_PASSWORD@$FTP_HOST/build
  - curl -T build/uPMT-win-x64.zip ftp://$FTP_USER:$FTP_PASSWORD@$FTP_HOST/build
  - curl -T build/libs/uPMT.jar ftp://$FTP_USER:$FTP_PASSWORD@$FTP_HOST/build

before_deploy:
 - git config --local user.name "Thykof"
 - git config --local user.email "thykof@protonmail.ch"
 - export TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)}
 - git tag $TRAVIS_TAG

deploy:
 provider: releases
 token: $token
 file:
  - "build/libs/uPMT.jar"
  - "build/uPMT-osx-x64.zip"
  - "build/uPMT-win-x64.zip"
 on: master
 skip_cleanup: true
